<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>table</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Charisma, a fully featured, responsive, HTML5, Bootstrap admin template.">
    <meta name="author" content="Muhammad Usman">
    <!-- The styles -->
    <link id="bs-css" th:href="@{/bootstrap/css/bootstrap-cerulean.min.css}" rel="stylesheet">
    <link th:href="@{/charisma/css/charisma-app.css}" rel="stylesheet">
    <link th:href="@{/charisma/fullcalendar/fullcalendar.css}" rel='stylesheet'>
    <link th:href="@{/charisma/fullcalendar/fullcalendar.print.css}" rel='stylesheet' media='print'>
    <link th:href="@{/charisma/chosen/chosen.min.css}" rel='stylesheet'>
    <link th:href="@{/charisma/colorbox/colorbox.css}" rel='stylesheet'>
    <link th:href="@{/charisma/responsive-tables/responsive-tables.css}" rel='stylesheet'>
    <link th:href="@{/charisma/bootstrap-tour/css/bootstrap-tour.min.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/jquery.noty.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/noty_theme_default.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/elfinder.min.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/elfinder.theme.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/jquery.iphone.toggle.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/uploadify.css}" rel='stylesheet'>
    <link th:href="@{/charisma/css/animate.min.css}" rel='stylesheet'>
    <!-- jQuery -->
    <script th:src="@{/js/jquery/jquery.min.js}"></script>
    <link rel="shortcut icon" th:href="@{/img/favicon.ico}">
</head>

<body>
<!-- loading start -->
<div id='fullScreen' class="fullScreen" style="display: none;">
    <div style="margin-top: 15%;">
        <p>
            <img th:src="@{/img/fullScreen.gif}" alt="">
        </p>
    </div>
</div>
<!-- loading end -->
<!-- topbar starts -->
<div class="navbar navbar-default" role="navigation"
     style="background-image: linear-gradient(#bbacac, #ffffff 60%, #ffffff); border-color: #ffffff;">

    <div class="">
        <a class="navbar-brand" href="index">
            <!--<img alt="Charisma Logo" th:src="@{/charisma/img/logo20.png}" class="hidden-xs"/> -->
            <span>Piflow-Web</span></a>

        <!-- user dropdown starts -->
        <div class="btn-group pull-right">
            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                <i class="glyphicon glyphicon-user"></i><span class="hidden-sm hidden-xs"> admin</span>
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><a href="#">Profile</a></li>
                <li class="divider"></li>
                <li>
                    <a href="javascript:document.logoutForm.submit();">Logout</a>
                    <form style="display: none" name="logoutForm" th:action="@{/logout}" method="post"></form>
                </li>
            </ul>
        </div>
        <!-- user dropdown ends -->
    </div>
</div>
<!-- topbar ends -->
<div class="ch-container">
    <div class="row">
        <!-- left menu starts -->
        <div class="col-sm-2 col-lg-2">
            <ul class="nav nav-pills nav-stacked main-menu">
                <!--
                <li>
                    <a class="ajax-link" onclick="loadGetRight('/piflow-web/web/indexHome')">
                        <i class="glyphicon glyphicon-home"></i>
                        <span> Dashboard</span>
                    </a>
                </li>
                -->
                <li>
                    <a class="ajax-link" onclick="initFlows('/piflow-web/web/flowList')" style="color: #8F8F8F;">
                        <i class="glyphicon glyphicon-align-justify"></i>
                        <span>Flows</span>
                    </a>
                </li>
                <li>
                    <a class="ajax-link" onclick="initAll('/piflow-web/process/getProcessList')" style="color: #8F8F8F;">
                        <i class="glyphicon glyphicon-align-justify"></i>
                        <span>Process</span>
                    </a>
                </li>
                <li>
                    <a class="ajax-link" onclick="initTemplate('/piflow-web/web/template')" style="color: #8F8F8F;">
                        <i class="glyphicon glyphicon-globe"></i>
                        <span>Template</span>
                    </a>
                </li>
            </ul>
        </div>
        <!--/span-->
        <!-- left menu ends -->
        <div id="content" class="col-lg-10 col-sm-10">
            <!-- content starts -->
            <!-- <div class="rightBar" style="width: 100%; height: 100%">
                <div th:include="/flow/inc/index_right :: index_right"></div>
                -------------------------------------------------------------
            </div> -->
            <div th:replace="/flow/inc/template_right :: table"></div>
            <!-- content ends -->
        </div><!--/#content.col-md-0-->
    </div><!--/fluid-row-->

    <hr>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">

        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h3>Settings</h3>
                </div>
                <div class="modal-body">
                    <p>Here settings can be configured...</p>
                </div>
                <div class="modal-footer">
                    <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>
                    <a href="#" class="btn btn-primary" data-dismiss="modal">Save changes</a>
                </div>
            </div>
        </div>
    </div>


</div> 

<script th:src="@{/bootstrap/js/bootstrap.min.js}"></script>

<!-- library for cookie management -->
<script th:src="@{/charisma/js/jquery.cookie.js}"></script>
<!-- calender plugin -->
<script th:src="@{/charisma/moment/min/moment.min.js}"></script>
<script th:src="@{/charisma/fullcalendar/fullcalendar.min.js}"></script>
<!-- data table plugin -->
<script th:src="@{/charisma/js/jquery.dataTables.min.js}"></script>
<!-- select or dropdown enhancer -->
<script th:src="@{/charisma/chosen/chosen.jquery.min.js}"></script>
<!-- plugin for gallery image view -->
<script th:src="@{/charisma/colorbox/js/jquery.colorbox-min.js}"></script>
<!-- notification plugin -->
<script th:src="@{/charisma/js/jquery.noty.js}"></script>
<!-- library for making tables responsive -->
<script th:src="@{/charisma/responsive-tables/responsive-tables.js}"></script>
<!-- tour plugin -->
<script th:src="@{/charisma/bootstrap-tour/js/bootstrap-tour.min.js}"></script>
<!-- star rating plugin -->
<script th:src="@{/charisma/js/jquery.raty.min.js}"></script>
<!-- for iOS style toggle switch -->
<script th:src="@{/charisma/js/jquery.iphone.toggle.js}"></script>
<!-- autogrowing textarea plugin -->
<script th:src="@{/charisma/js/jquery.autogrow-textarea.js}"></script>
<!-- multiple file upload plugin -->
<script th:src="@{/charisma/js/jquery.uploadify-3.1.min.js}"></script>
<!-- history.js for cross-browser state change on ajax -->
<script th:src="@{/charisma/js/jquery.history.js}"></script>
<!-- application script for Charisma demo -->
<script th:src="@{/charisma/js/charisma.js}"></script>
<script th:inline="javascript">
var token = $("meta[name='_csrf']").attr("content");
var header = $("meta[name='_csrf_header']").attr("content");
$(document).ajaxSend(function (e, xhr, options) {
    xhr.setRequestHeader(header, token);
});
    function initTemplate(url) {
    	   window.location.href = url;
    }

    function initFlows(url) {
        window.location.href = url;
    }

    //@ sourceURL=table.js
</script>
<script type="text/javascript">
  function deleteTemPlate(id, name) {
	  layer.confirm("Are you sure to delete '" + name + "' ?", {
		  btn: ['confirm','cancel'] //按钮
	 	 ,title: 'Confirmation prompt' 
		}, function(){
			$.ajax({
	              cache: true,//保留缓存数据
	              type: "get",//为post请求
	              url: "/piflow-web/template/deleteTemplate",//这是我在后台接受数据的文件名
	              data: {id: id},
	              async: true,//设置成true，这标志着在请求开始后，其他代码依然能够执行。如果把这个选项设置成false，这意味着所有的请求都不再是异步的了，这也会导致浏览器被锁死
	              error: function (request) {//请求失败之后的操作
	                  return;
	              },
	              success: function (data) {//请求成功之后的操作
	                  if (data > 0) {
	                      layer.msg('Delete Success', {icon: 1, shade: 0, time: 2000}, function () {
	                    	  location.reload();
	                      });
	                  } else {
	                      layer.msg('Delete failed', {icon: 2, shade: 0, time: 2000}, function () {});
	                  }
	              }
	          });
		}, function(){});
  }
  function initAll(url) {
      window.location.href = url;
  }
  
  function uploadTemplate(){
	  document.getElementById("templateFile").click();
  }
  
  function importFile(){
	  if(!FileTypeCheck()) {
	 		return false;
	 	}
      var formData = new FormData($('#uploadForm')[0]);
      $.ajax({
          type: 'post',
          url: "/piflow-web/template/upload",
          data: formData,
          cache: false,
          processData: false,
          contentType: false,
      }).success(function (data) {
    	  var dataMap = JSON.parse(data);
    	  if (0 !== dataMap.code) {
    		  layer.msg(dataMap.errMsg, {icon: 1, shade: 0, time: 2000}, function () {  location.reload();});
    	  }else{
    		  layer.msg(dataMap.errMsg, {icon: 2, shade: 0, time: 2000}, function () {});
    	  }
      }).error(function () {
          layer.msg("Upload failure", {icon: 2, shade: 0, time: 2000}, function () {});
      });
  }
  
  function FileTypeCheck()
  {
  var obj =document.getElementById('templateFile'); 
  if(obj.value==null || obj.value ==''){ 
  	layer.msg('please upload the XML file', {icon: 2, shade: 0, time: 2000}, function () {});
  	this.focus()
  	return false;
  }
  var length = obj.value.length;
  var charindex = obj.value.lastIndexOf(".");
  var ExtentName = obj.value.substring(charindex,charindex+4);
  if(!(ExtentName == ".xml" )){
  	layer.msg('please upload the XML file', {icon: 2, shade: 0, time: 2000}, function () {});
  	this.focus()
  	return false;
  }
  	return true;
  }
  
  function downloadTemplate(id){
	  window.location.href = "/piflow-web/template/templateDownload?templateId="+id;
  }
 </script>
 
</body>
</html>
