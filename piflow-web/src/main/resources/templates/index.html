<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <title>piflow-web</title>
    <link rel="shortcut icon" href="/piflow-web/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/piflow-web/custom/css/fullScreen.css"/>
    <link rel="stylesheet" type="text/css" href="/piflow-web/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="/piflow-web/components/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/piflow-web/components/font-awesome-4.7.0/css/font-awesome.min.css"/>

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href='/piflow-web/css/ie8.css'/>
    <![endif]-->

    <script type="text/javascript" src="/piflow-web/js/jquery/jquery.min.js"></script>
    <script type="text/javascript" src="/piflow-web/js/jquery/jquery.easytabs.min.js"></script>
    <script type="text/javascript" src="/piflow-web/js/jquery/jquery.collapsible.min.js"></script>
    <script type="text/javascript" src="/piflow-web/js/dataTables1.10.18/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/piflow-web/js/functions.js"></script>
    <script type="text/javascript" src="/piflow-web/components/layui/layui.all.js"></script>
    <style>
        .paginate_button current {
            color: #c40029;
            background: #c40029;
        }

        .table_tr_th {
            color: #1A7444;
        }

        .error_class {
            border-color: #FF5722 !important;
        }

        .layui-table-cell {
            height: 36px;
            line-height: 36px;
        }
    </style>
</head>

<body>
<!-- Fixed top -->
<div id="top"></div>
<!-- /fixed top -->


<!-- Content container -->
<div id="container">

    <!-- Sidebar -->
    <div id="sidebar">

        <div id="general">

            <!-- Main navigation -->
            <ul id="menuGroupsId" class="navigation widget">
                <li><a th:href="@{/index}" title=""><i class="icon-home"></i>Dashboard</a></li>
            </ul>
            <!-- /main navigation -->

        </div>

    </div>
    <!-- /sidebar -->


    <!-- Content -->
    <div id="content">

    </div>
    <!-- /content -->
    <!--
        <div id="div_indexHome_id" style="display: none;">
            <div id="div_indexHome_content_id"></div>
        </div>
        <div id="div_flowList_id" style="display: none;" case="'flowList'">
            <div id="div_flowList_content_id"></div>
        </div>
        <div style="display: none;" case="'processList'">
            <div th:include="indexRight/flow/process_List :: process_List"></div>
        </div>
        <div style="display: none;" case="'template'">
            <div th:include="indexRight/flow/template_List :: template_List"></div>
        </div>
        <div style="display: none;" case="'flowGroupList'">
            <div th:include="indexRight/flowGroup/flow_group_List :: flow_group_List"></div>
        </div>
        <div style="display: none;" case="'processGroupList'">
            <div th:include="indexRight/flowGroup/process_group_List :: process_group_List"></div>
        </div>
        <div style="display: none;" case="'flowGroupTemplateList'">
            <div th:include="indexRight/flowGroup/flow_group_template_List :: flow_group_template_List"></div>
        </div>
        <div style="display: none;" case="'dataSources'">
            <div th:include="indexRight/datasource/data_source_List :: data_source_List"></div>
        </div>
        <div style="display: none;" case="'processAndProcessGroup'">
            <div th:include="indexRight/custom/process_processGroup_list :: process_processGroup_list"></div>
        </div>
        <div style="display: none;" case="'flowTemplateList'">
            <div th:include="indexRight/custom/flow_template_List :: flow_template_List"></div>
        </div>
        <div style="display: none;" case="'instructionalVideo'">
            <div th:include="indexRight/example/instructional_Video :: instructional_Video"></div>
        </div>
        <div style="display: none;" case="'sysScheduleList'">
            <div th:include="indexRight/admin/sys_schedule_List :: sys_schedule_List"></div>
        </div>
        -->
</div>
<!-- /content container -->


<!-- Footer -->
<!--<div id="footer"></div>-->
<div th:include="macro/publicMacro :: footHeadMacro"></div>


<div th:include="macro/fragmentMacro :: fullScreen"></div>
<!-- /footer -->
<script type="text/javascript" th:src='@{/components/bootstrap/js/bootstrap.min.js}'></script>
<script th:src="@{/js/ajaxUtils.js}"></script>
<script th:inline="javascript">
    var urlParams = getUrlParams(window.location.href);
    var currentUser = JSON.parse(localStorage.jwtUser);
    var accessPath = urlParams.accessPath;
    var projectContextPath = "/piflow-web";
    var projectContextPath_test = [[${#httpServletRequest.getContextPath()}]];

    (function () {
        $("#top").load("/piflow-web/page/macro/headMacro.html", function () {
            $("#span_username_id").html('Howdy,' + currentUser.username + '<b class="caret"></b>');
        });
        if (currentUser) {
            var sysMenuVoList = currentUser.sysMenuVoList;
            if (sysMenuVoList && sysMenuVoList.length > 0) {
                initMenuFunc(sysMenuVoList);
            }
        }
        if (accessPath && 'indexHome' !== accessPath) {
            switch (accessPath) {
                case 'flowList':
                    $("#content").load("/piflow-web/page/flowList");
                    break;
                case 'flowGroupList':
                    $("#content").load("/piflow-web/page/flowGroupList");
                    break;
                default:
                    break;
            }
        } else {
            $("#content").load("/piflow-web/page/dashboard");
        }
    })();

    function initMenuFunc(sysMenuVoList) {
        var menuGroupsUser = {};
        var menuGroups = $('#menuGroupsId');
        var currentPathArray = window.location.pathname.split(projectContextPath);
        var currentPathParam = window.location.search;
        var currentPath = "";
        if (currentPathArray.length == 1) {
            currentPath = currentPathArray[0];
        } else {
            currentPath = currentPathArray[currentPathArray.length - 1];
        }
        $.each(sysMenuVoList, function (n, value) {
            var menuParentHtml = "";
            var active_li_id = "";
            var valueMenuParent = value.menuParent;
            if (valueMenuParent) {
                menuParentHtml = menuGroupsUser[valueMenuParent];
                if (!menuParentHtml) {
                    active_li_id = 'active_li_' + valueMenuParent;
                    menuParentHtml = '<li id="' + active_li_id + '">'
                        + '<a id="active_a_' + valueMenuParent + '" href="#" title="' + value.menuDescription + '" class="expand">'
                        + '<i class="icon-reorder"></i>'
                        + valueMenuParent
                        + '<strong style="background:#20794b">0</strong>'
                        + '</a>'
                        + '<ul></ul>'
                        + '</li>';
                    menuParentHtml = $(menuParentHtml);
                }
                var counts = parseFloat(menuParentHtml.find("strong").text());
                menuParentHtml.find("strong").html(counts + 1);
                var currentMenu = '<li>'
                    + '<a class="' + value.menuName + '" href="' + value.menuUrl + '" title="' + value.menuDescription + '">'
                    + value.menuName
                    + '</a>'
                    + '</li>';
                menuParentHtml.find("ul").append(currentMenu);
            } else {
                valueMenuParent = 'one_menu_' + value.id;
                active_li_id = 'active_li_' + valueMenuParent;
                menuParentHtml = '<li id="' + active_li_id + '">'
                    + '<a href="' + value.menuUrl + '" title="' + value.menuDescription + '">'
                    + '<i class="icon-reorder"></i>'
                    + value.menuName + ''
                    + '</a>'
                    + '</li>';
                menuParentHtml = $(menuParentHtml);
            }
            if (value.menuUrl) {
                console.log("gggggg");
                var menuUrlSpits = value.menuUrl.split(projectContextPath);
                var menuActiveMenuId = "";
                if (menuUrlSpits.length == 1) {
                    menuActiveMenuId = menuUrlSpits[0];
                } else {
                    menuActiveMenuId = menuUrlSpits[menuUrlSpits.length - 1];
                }
                if (currentMenu) {
                    var menu_id_str = value.menuUrl.replace(new RegExp("/", "gm"), "_");
                    menuParentHtml.find("a." + value.menuName).attr("menu_id", menu_id_str + '_menu_id');
                    menuParentHtml.find("a." + value.menuName).attr("active_li_id", active_li_id);
                }
                if ((currentPath + currentPathParam).indexOf(menuActiveMenuId) === 0) {
                    menuParentHtml.attr("class", "active");
                    menuParentHtml.find(".expand").attr("id", "current");
                    menuParentHtml.find(".expand").addClass("current");
                }
            }
            menuGroupsUser[valueMenuParent] = menuParentHtml;
            menuGroups.append(menuParentHtml);
        });
        var currentUrlId = window.location.pathname.replace(new RegExp("/", "gm"), "_") + '_menu_id';
        $('a[menu_id=' + currentUrlId + ']').addClass("current");
    }

    //@ sourceURL=index.js
</script>
</body>
</html>
