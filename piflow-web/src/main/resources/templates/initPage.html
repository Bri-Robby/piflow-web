<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>Piflow-Web</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta th:include="Macro/csrfTokeHeadMacro :: csrfTokeHeadMacro"/>
    <link rel="stylesheet" type="text/css" th:href="@{/components/bootstrap/css/bootstrap-cerulean.min.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/custom/css/publicMacro.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/components/layui/css/layui.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/custom/css/fullScreen.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/components/jquery.steps/css/normalize.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/components/jquery.steps/css/main.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/components/jquery.steps/css/jquery.steps.css}"/>

    <!-- jQuery -->
    <script type="text/javascript" th:src="@{/js/jquery/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.form.3.51.0/jquery.form.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.validate.1.13.1/jquery.validate.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/jquery.validate.1.13.1/jquery.validate.addMethod.js}"></script>
    <script type="text/javascript" th:src="@{/components/layui/layui.all.js}"></script>
    <script type="text/javascript" th:src="@{/components/jquery.steps/js/jquery.steps.js}"></script>
    <!-- The fav icon -->
    <link rel="shortcut icon" th:href="@{/img/logo.ico}">
</head>
<body>
<div th:include="Macro/publicMacro :: loginHeadMacro"></div>
<div>
    <div style="height: 100px; text-align: center;">
        <span style="line-height: 58px;"></span>
        <br>
        <span style="font-size: 20px;">Boot page</span>
    </div>
    <div id="example-basic">
        <h3>Init Stops</h3>
        <section>
            <p>Please try to click next to initialize the related Stops!</p>
        </section>
        <h3>Init Sample</h3>
        <section>
            <p>Please try clicking the next step to initialize the related samples!</p>
        </section>
        <h3>Jump Home</h3>
        <section>
            <p>Click Finish to jump to the homepage.</p>
        </section>
    </div>
</div>
<div th:include="Macro/fragmentMacro :: fullScreen"></div>
<script type="text/javascript">
    var isInitStopsSuccessfully = false;
    var isInitSampleSuccessfully = false;
    window.onload = function () {
        $("#example-basic").steps({
            headerTag: "h3",
            bodyTag: "section",
            transitionEffect: "slideLeft",
            autoFocus: true,
            onStepChanging: function (event, currentIndex, newIndex) {
                $('#fullScreen').show();
                if (currentIndex < newIndex) {
                    console.log("----------------00000----------------");
                    switch (currentIndex) {
                        case 0: {
                            if (!isInitStopsSuccessfully) {
                                if (initStops()) {
                                    isInitStopsSuccessfully = true;
                                } else {
                                    isInitStopsSuccessfully = false;
                                }
                                return isInitStopsSuccessfully;
                            }
                        }
                            break;
                        case 1: {
                            if (!isInitSampleSuccessfully) {
                                if (initSample()) {
                                    isInitSampleSuccessfully = true;
                                } else {
                                    isInitSampleSuccessfully = false;
                                }
                                return isInitSampleSuccessfully;
                            }
                        }
                            break;
                    }
                }
                $('#fullScreen').hide();
                return true;
            },
            onStepChanged: function (event, currentIndex, priorIndex) {
                console.log("priorIndex：" + priorIndex);
                console.log("currentIndex：" + currentIndex);
            },
            onFinishing: function (event, currentIndex) {
                if (isInitSampleSuccessfully && isInitSampleSuccessfully) {
                    if (bootComplete()) {
                        return true;
                    }
                }
                return false;
            },
            onFinished: function (event, currentIndex) {
                console.log("Submitted!");
                home();
            }
        });
    }

    function home() {
        window.location.href = "/piflow-web/";
    }

    function initStops() {
        $('#fullScreen').show();
        var isSuccessfully = false;
        $.ajax({
            cache: true,//Keep cached data
            type: "GET",//Request type post
            async: false,
            url: "/piflow-web/bootPage/initStops",//This is the name of the file where I receive data in the background.
            error: function (request) {//Operation after request failure
                $('#fullScreen').hide();
                //alert("reload fail");
                layer.msg("reload fail,please try again", {icon: 2, shade: 0, time: 2000}, function () {
                });
            },
            success: function (data) {//Operation after request successful
                var dataMap = JSON.parse(data);
                $('#fullScreen').hide();
                if (200 === dataMap.code) {
                    // isInitStopsSuccessfully = true;
                    isSuccessfully = true;
                } else {
                    // alert("reload fail");
                    layer.msg("reload fail,please try again", {icon: 2, shade: 0, time: 2000}, function () {
                        // return false;
                    });
                }
            }
        });
        return isSuccessfully;
    }

    function initSample() {
        $('#fullScreen').show();
        var isSuccessfully = false;
        $.ajax({
            type: "GET",//Request type post
            async: false,
            url: "/piflow-web/bootPage/initSample",//This is the name of the file where I receive data in the background.
            error: function (request) {//Operation after request failure
                // $('#fullScreen').hide();
                //alert("reload fail");
                layer.msg("reload fail", {icon: 2, shade: 0, time: 2000}, function () {
                });
                isSuccessfully = false;
            },
            success: function (data) {//Operation after request successful
                var dataMap = JSON.parse(data);
                $('#fullScreen').hide();
                if (200 === dataMap.code) {
                    // isInitSampleSuccessfully = true;
                    isSuccessfully = true;
                } else {
                    //alert("reload fail");
                    layer.msg("reload fail", {icon: 2, shade: 0, time: 2000}, function () {
                        isSuccessfully = false;
                    });
                }
            }
        });
        return isSuccessfully;
    }

    function bootComplete() {
        $('#fullScreen').show();
        var isSuccessfully = false;
        $.ajax({
            type: "GET",//Request type post
            async: false,
            url: "/piflow-web/bootPage/bootComplete",//This is the name of the file where I receive data in the background.
            error: function (request) {//Operation after request failure
                // $('#fullScreen').hide();
                //alert("reload fail");
                layer.msg("Jump failed, please try again", {icon: 2, shade: 0, time: 2000}, function () {
                });
                isSuccessfully = false;
            },
            success: function (data) {//Operation after request successful
                var dataMap = JSON.parse(data);
                $('#fullScreen').hide();
                if (200 === dataMap.code) {
                    // isInitSampleSuccessfully = true;
                    isSuccessfully = true;
                } else {
                    //alert("reload fail");
                    layer.msg("Jump failed, please try again", {icon: 2, shade: 0, time: 2000}, function () {
                        isSuccessfully = false;
                    });
                }
            }
        });
        return isSuccessfully;
    }

    //@ sourceURL=initPage.js
</script>
</body>
</html>
